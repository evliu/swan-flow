/**
 * Bitcoin Chart View
 *
 * endpoint: https://production.api.coindesk.com/v2/tb/price/values/BTC?start_date=2023-02-02T23:50&end_date=2023-12-01T00:00&interval=1d
 * returns this json: {"statusCode":200,"message":"OK","data":{"iso":"BTC","name":"Bitcoin","slug":"bitcoin","ingestionStart":"2014-11-03","interval":"1d","src":"tb","entries":[[1675382399000,23485.061582],[1675468799000,23436.180364],[1675555199000,23333.551208],[1675641599000,22941.489657],[1675727999000,22764.07],[1675814399000,23252.257081],[1675900799000,22963.91],[1675987199000,21798.175067],[1676073599000,21636.89653],[1676159999000,21864.976479],[1676246399000,21788.619839],[1676332799000,21788.905783],[1676419199000,22207.533729],[1676505599000,24332.633646],[1676591999000,23522],[1676678399000,24576.000189],[1676764799000,24637.905503],[1676851199000,24287.2],[1676937599000,24840.355316],[1677023999000,24452.183544],[1677110399000,24186.6],[1677196799000,23941.32],[1677283199000,23189.869571],[1677369599000,23166.133582],[1677455999000,23560.213169],[1677542399000,23492.905234],[1677628799000,23132.483294],[1677715199000,23637.704804],[1677801599000,23467.280643],[1677887999000,22358.515387],[1677974399000,22348.191077],[1678060799000,22429.093868],[1678147199000,22406.665607],[1678233599000,22197.59233],[1678319999000,21699.687515],[1678406399000,20366.521882],[1678492799000,20227.617085],[1678579199000,20622.075456],[1678665599000,22195.098168],[1678751999000,24206.469566],[1678838399000,24768.103125],[1678924799000,24371.145776],[1679011199000,25050.099158],[1679097599000,27450.705505],[1679183999000,26978.280027],[1679270399000,28047.35],[1679356799000,27817.412391],[1679443199000,28195.741794],[1679529599000,27324.891117],[1679615999000,28348.755059],[1679702399000,27491.317316],[1679788799000,27494.84],[1679875199000,28000],[1679961599000,27149.190148],[1680047999000,27275.46335],[1680134399000,28355.285911],[1680220799000,28040.842291],[1680307199000,28478],[1680393599000,28469.081209],[1680479999000,28191.127283],[1680566399000,27811.221316],[1680652799000,28179.270633],[1680739199000,28182.546506],[1680825599000,28049.557179],[1680911999000,27927.947764],[1680998399000,27959.33182],[1681084799000,28342.548857],[1681171199000,29657.361539],[1681257599000,30231.515364],[1681343999000,29905.160808],[1681430399000,30410.110682],[1681516799000,30492.826526],[1681603199000,30325.150889],[1681689599000,30328.225231],[1681775999000,29448.06715],[1681862399000,30393.42414],[1681948799000,28832.683429],[1682035199000,28246.312528],[1682121599000,27263.022938],[1682207999000,27819.017688],[1682294399000,27596.113487],[1682380799000,27519.250114],[1682467199000,28308.415222],[1682553599000,28429.986481],[1682639999000,29486.664234],[1682726399000,29341.189703],[1682812799000,29250.000904],[1682899199000,29232.868484],[1682985599000,28086.401607],[1683071999000,28679.930349],[1683158399000,29034.9544],[1683244799000,28855.172242],[1683331199000,29539.619433],[1683417599000,28906.728411],[1683503999000,28461],[1683590399000,27695.457474],[1683676799000,27645.457841],[1683763199000,27622.638014],[1683849599000,26995.745196],[1683935999000,26805.474121],[1684022399000,26789.54302],[1684108799000,26930.731933],[1684195199000,27179.55108],[1684281599000,27036.607872],[1684367999000,27402.845818],[1684454399000,26823.12],[1684540799000,26887.850698],[1684627199000,27119.26],[1684713599000,26755.086586],[1684799999000,26854.604708],[1684886399000,27224.214534],[1684972799000,26328.313071],[1685059199000,26480.655037],[1685145599000,26718.329886],[1685231999000,26870.659736],[1685318399000,28080.73389],[1685404799000,27746.101245],[1685491199000,27702.417693],[1685577599000,27217.560511],[1685663999000,26822.021069],[1685750399000,27252.03765],[1685836799000,27077.388715],[1685923199000,27126.034346],[1686009599000,25737.47817],[1686095999000,27240.646262],[1686182399000,26349.275992],[1686268799000,26507.27924],[1686355199000,26483.606569],[1686441599000,25855.535943],[1686527999000,25933.607032],[1686614399000,25903.776667],[1686700799000,25923.561863],[1686787199000,25125.788053],[1686873599000,25572.386272],[1686959999000,26327.492635],[1687046399000,26509.176006],[1687132799000,26335.632029],[1687219199000,26839.61],[1687305599000,28316.802027],[1687391999000,29996.132365],[1687478399000,29896.236372],[1687564799000,30699.755556],[1687651199000,30548.098426],[1687737599000,30471.724406],[1687823999000,30273.061785],[1687910399000,30698.194008],[1687996799000,30080.575215],[1688083199000,30445.266304],[1688169599000,30472.719876],[1688255999000,30587.885862],[1688342399000,30616.114028],[1688428799000,31156.034789],[1688515199000,30774.670287],[1688601599000,30502.544393],[1688687999000,29912.377834],[1688774399000,30348.092769],[1688860799000,30291.68],[1688947199000,30170.203884],[1689033599000,30418.609017],[1689119999000,30625.656605],[1689206399000,30384.796186],[1689292799000,31471.82],[1689379199000,30328.5],[1689465599000,30298.219892],[1689551999000,30246.335413],[1689638399000,30144.743086],[1689724799000,29862.909143],[1689811199000,29916.681404],[1689897599000,29807.232695],[1689983999000,29909.823624],[1690070399000,29776.170072],[1690156799000,30081.61],[1690243199000,29178.932189],[1690329599000,29224.178304],[1690415999000,29348.241984],[1690502399000,29213.400678],[1690588799000,29314.2],[1690675199000,29357.34143],[1690761599000,29279.422233],[1690847999000,29230.361231],[1690934399000,29703.578632],[1691020799000,29161.89975],[1691107199000,29178.64346],[1691193599000,29077.317179],[1691279999000,29047.12],[1691366399000,29040.745791],[1691452799000,29180.619743],[1691539199000,29770.0663811],[1691625599000,29564.4123019],[1691711999000,29426.2478992],[1691798399000,29399.7387515],[1691884799000,29415.6667825],[1691971199000,29278.4422457],[1692057599000,29406.9680407],[1692143999000,29171.4607655],[1692230399000,28700.0397826],[1692316799000,26640.6093656],[1692403199000,26048.155472],[1692489599000,26092.9338394],[1692575999000,26189.6856372],[1692662399000,26124.1542882],[1692748799000,26040.4],[1692835199000,26429.1858917],[1692921599000,26160],[1693007999000,26048.6334200039],[1693094399000,26008.1527698],[1693180799000,26090.3518934],[1693267199000,26105.1451215],[1693353599000,27724.1023724],[1693439999000,27303.0247656],[1693526399000,25929.5432896],[1693612799000,25799.2338243],[1693699199000,25866.2754331],[1693785599000,25971.3622824],[1693871999000,25817.0126102],[1693958399000,25783.2703212],[1694044799000,25750.2926304],[1694131199000,26251.0840823],[1694217599000,25906.3156026],[1694303999000,25895.677314],[1694390399000,25833.0413744],[1694476799000,25154.8840683],[1694563199000,25840.3780988],[1694649599000,26227.6290422],[1694735999000,26532.7651698],[1694822399000,26606.3350691],[1694908799000,26567.6891802],[1694995199000,26531.8754105],[1695081599000,26764.4786083],[1695167999000,27216.3071154],[1695254399000,27126.4102273],[1695340799000,26565.5668302],[1695427199000,26578.599677],[1695513599000,26571.1137269],[1695599999000,26252.5147174366],[1695686399000,26295.7682205564],[1695772799000,26209.2676347211],[1695859199000,26355.8840426536],[1695945599000,27025.8451297626],[1696031999000,26909.2936390025],[1696118399000,26964.2796447048],[1696204799000,27975.865557161],[1696291199000,27510.4783713703],[1696377599000,27430.0332765386],[1696463999000,27793.8610245538],[1696550399000,27410.5274506934],[1696636799000,27949.5401743101],[1696723199000,27975.9766959441],[1696809599000,27937.0863523522],[1696895999000,27586.7392837271],[1696982399000,27394.2196179663],[1697068799000,26869.7825761674],[1697155199000,26753.4778296608],[1697241599000,26863.2714042008],[1697327999000,26854.1798281728],[1697414399000,27178.035638112],[1697500799000,28517.6443213889],[1697587199000,28411.1276293691],[1697673599000,28328.1400960556],[1697759999000,28733.3249854548],[1697846399000,29683.8857616121],[1697932799000,29922.2693724589],[1698019199000,29994.4397358381],[1698105599000,33072.5789750117],[1698191999000,33911.1056948543],[1698278399000,34497.8310997669],[1698364799000,34158.414493342],[1698451199000,33911.5893834243],[1698537599000,34091.1217892101],[1698623999000,34531.4305648207],[1698710399000,34493.3227720886],[1698796799000,34659.905033154],[1698883199000,35436.8465321029],[1698969599000,34934.1398402549],[1699055999000,34730.3142321265],[1699142399000,35079.5695730131],[1699228799000,35044.486356129],[1699315199000,35044.2580096426],[1699401599000,35433.9790695265],[1699487999000,35631.0094163499],[1699574399000,36703.0010359689],[1699660799000,37320.4319652101],[1699747199000,37149.6804577153],[1699833599000,37080.1563993809],[1699919999000,36488.659818304],[1700006399000,35548.3950579837],[1700092799000,37884.3543043321],[1700179199000,36164.6844999025],[1700265599000,36614.9094033739],[1700351999000,36587.196448109],[1700438399000,37382.955495735],[1700524799000,37479.7476284747],[1700611199000,35787.9308561434],[1700697599000,37427.1876778036],[1700783999000,37297.9175726889],[1700870399000,37738.5111953284],[1700956799000,37805.6379931661],[1701043199000,37470.9611737023],[1701129599000,37248.9606741561],[1701215999000,37834.1484669344],[1701302399000,37861.846510348]]}}
 */

import 'dart:async';
import 'dart:convert';

import 'package:flutter/material.dart';
import 'package:fl_chart/fl_chart.dart';
import 'package:intl/intl.dart';
import 'package:http/http.dart' as http;

import '../constants.dart';

// based on the endpoint, create a service that will retrieve the data for the last 3 months

class BitcoinChartView extends StatefulWidget {
  const BitcoinChartView({super.key});

  @override
  State<BitcoinChartView> createState() => _BitcoinChartViewState();
}

class _BitcoinChartViewState extends State<BitcoinChartView> {
  @override
  Widget build(BuildContext context) {
    return Container();
  }
}

// create an abstract class that defines the interface for the service BitcoinPriceService
abstract class BitcoinPriceService2 {
  Stream<double> get priceStream;
  String get lastUpdated;
  bool get isLoading;
  void startRefreshing();
  void stopRefreshing();
  void fetchBitcoinPrice();
  void dispose();
}

// create a service that retreives bitcoin price data for the last 3 months

// fl chart widget
// https://github.com/imaNNeo/fl_chart/blob/master/repo_files/documentations/line_chart.md
//
class BitcoinLineChart extends StatelessWidget {
  BitcoinLineChart({super.key});

  final LineChartData lineChartData = LineChartData(
    backgroundColor: SwanColors.coolBlue.value,
    gridData: FlGridData(
      show: true,
      drawVerticalLine: true,
      getDrawingHorizontalLine: (value) {
        return FlLine(
          color: SwanColors.coolBlue.value,
          strokeWidth: 1,
        );
      },
      getDrawingVerticalLine: (value) {
        return FlLine(
          color: SwanColors.coolBlue.value,
          strokeWidth: 1,
        );
      },
    ),
  );

  @override
  Widget build(BuildContext context) {
    return Container(
        decoration: BoxDecoration(
          gradient: LinearGradient(
            begin: Alignment.topCenter,
            end: Alignment.bottomCenter,
            colors: [
              SwanColors.coolBlue.value,
              SwanColors.trueBlue.value,
            ],
          ),
        ),
        child: Expanded(child: LineChart(lineChartData)));
  }
}
